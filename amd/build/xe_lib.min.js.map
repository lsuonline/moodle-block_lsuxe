{"version":3,"file":"xe_lib.min.js","names":["define","$","jaxy","preLoadConfig","window_stat","window","__SERVER__","__INITIAL_STATE__","JSON","parse","error","console","log","key","_typeof","subkey_list","subkey","sessionStorage","setItem","pushPost","redirectUrl","data","input_part","form_part","form","value","append","submit","testWebServices","params","jaxyRemotePromise","getTokenForURL","url","jaxyPromise","call","class","isValidUrl","urlString","test","promiseObj","Promise","resolve","XEAjax","stringify","then","response","XERemoteAjax"],"sources":["../src/xe_lib.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Cross Enrollment Tool\n *\n * @package   block_lsuxe\n * @copyright 2008 onwards Louisiana State University\n * @copyright 2008 onwards David Lowe, Robert Russo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'block_lsuxe/jaxy'],\n    function($, jaxy) {\n    'use strict';\n    return {\n\n        /**\n         * Store data in sessionStorage so it's available throughout\n         *\n         * @param {object} the json object to save\n         * @return null\n         */\n        preLoadConfig: function() {\n            var window_stat = {};\n\n            if (window.__SERVER__ === \"true\" || window.__SERVER__ === true) {\n                if (typeof (window.__INITIAL_STATE__) === 'string') {\n                    try {\n                        window_stat = JSON.parse(window.__INITIAL_STATE__);\n                        delete window.__INITIAL_STATE__;\n                        window.__SERVER__ = false;\n                    } catch (error) {\n                        console.log(error);\n                    }\n                }\n            } else {\n                console.log(\"WARNING: window.__SERVER__ was not set\");\n            }\n            for (var key in window_stat) {\n                if (typeof(window_stat[key]) === 'object') {\n                    let subkey_list = window_stat[key];\n                    for (var subkey in subkey_list) {\n                        sessionStorage.setItem(subkey, subkey_list[subkey]);\n                    }\n                } else {\n                    sessionStorage.setItem(key, window_stat[key]);\n                }\n            }\n        },\n\n        /**\n         * Post data to a URL. This is a form submit and will cause a page reload POSTing data.\n         *\n         * @param {string} redirectUrl to post to, self if nothing passed.\n         * @param {object} the json object to post\n         * @return {Promise}\n         */\n        pushPost: function(redirectUrl, data) {\n\n            var input_part = '',\n                form_part = '',\n                form;\n\n            for (var key in data) {\n                var value = data[key];\n                input_part += '<input type=\"hidden\" value=\"' + value + '\" name=\"' + key + '\"></input>';\n            }\n\n            form_part = '<form method=\"POST\" style=\"display: none;\">' + input_part + '</form>';\n            form = $(form_part);\n            $('body').append(form);\n            $(form).submit();\n        },\n\n        /**\n         * Get the token for the current selected URL\n         *\n         * @param {string} token\n         * @return {Promise}\n         */\n        testWebServices: function (params) {\n            return this.jaxyRemotePromise(params);\n        },\n\n        /**\n         * Get the token for the current selected URL\n         *\n         * @param {string} token\n         * @return {Promise}\n         */\n        getTokenForURL: function (url) {\n            return this.jaxyPromise({\n                'call': 'get_token',\n                'params': {\n                    'url': url\n                },\n                'class': 'router'\n            });\n        },\n\n        /**\n         * Check the URL to see if it's valid. This is a work in progress.\n         *\n         * @param {string} token\n         * @return {string}\n         */\n        isValidUrl: function (urlString) {\n            var urlPattern = new RegExp('^(https?:\\\\/\\\\/)?'+ // validate protocol\n            '((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|'+ // validate domain name\n            '((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))'+ // validate OR ip (v4) address\n            '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*'+ // validate port and path\n            '(\\\\?[;&a-z\\\\d%_.~+=-]*)?'+ // validate query string\n            '(\\\\#[-a-z\\\\d_]*)?$','i'); // validate fragment locator\n            return !!urlPattern.test(urlString);\n        },\n\n        /* ====================================================================== */\n        /* ===================      AJAX Functions      ========================= */\n        /* ====================================================================== */\n        /** Make an AJAX call and return a json object, from server,\n         *  wrapping the AJAX call in a promise.\n         * @param - {object} the details of the ajax call\n         * @return {Promise}\n         */\n        jaxyPromise: function (data) {\n            var promiseObj = new Promise(function (resolve) {\n                jaxy.XEAjax(JSON.stringify(data)).then(function (response) {\n                    resolve(response);\n                });\n            });\n            return promiseObj;\n        },\n\n        /** Make an AJAX call and return a json object, from REMOTE server,\n         *  wrapping the AJAX call in a promise.\n         * @param - {object} the details of the ajax call\n         * @return {Promise}\n         */\n        jaxyRemotePromise: function (data) {\n            var promiseObj = new Promise(function (resolve) {\n                jaxy.XERemoteAjax(data).then(function (response) {\n                    resolve(response);\n                });\n            });\n            return promiseObj;\n        },\n    };\n});"],"mappings":"kRAwBAA,OAAM,sBAAC,CAAC,QAAQ,CAAE,kBAAkB,CAAC,CACjC,SAASC,CAAC,CAAEC,CAAI,CAAE,CAClB,YAAY,CACZ,MAAO,CAQHC,aAAa,CAAE,SAAAA,cAAA,CAAW,CACtB,GAAI,CAAAC,CAAW,CAAG,CAAC,CAAC,CAEpB,GAA0B,MAAM,GAA5BC,MAAM,CAACC,UAAqB,EAAI,KAAAD,MAAM,CAACC,UAAmB,CAAE,CAC5D,GAA0C,QAAQ,EAA9C,MAAQ,CAAAD,MAAM,CAACE,iBAA+B,CAAE,CAChD,GAAI,CACAH,CAAW,CAAGI,IAAI,CAACC,KAAK,CAACJ,MAAM,CAACE,iBAAiB,CAAC,CAClD,MAAO,CAAAF,MAAM,CAACE,iBAAiB,CAC/BF,MAAM,CAACC,UAAU,GACrB,CAAE,MAAOI,CAAK,CAAE,CACZC,OAAO,CAACC,GAAG,CAACF,CAAK,CACrB,CACJ,CACJ,CAAC,IAAM,CACHC,OAAO,CAACC,GAAG,CAAC,wCAAwC,CACxD,CACA,IAAK,GAAI,CAAAC,CAAG,GAAI,CAAAT,CAAW,CAAE,CACzB,GAAiC,QAAQ,GAAAU,OAAA,CAA9BV,CAAW,CAACS,CAAG,CAAC,CAAc,CAAE,CACvC,GAAI,CAAAE,CAAW,CAAGX,CAAW,CAACS,CAAG,CAAC,CAClC,IAAK,GAAI,CAAAG,CAAM,GAAI,CAAAD,CAAW,CAAE,CAC5BE,cAAc,CAACC,OAAO,CAACF,CAAM,CAAED,CAAW,CAACC,CAAM,CAAC,CACtD,CACJ,CAAC,IAAM,CACHC,cAAc,CAACC,OAAO,CAACL,CAAG,CAAET,CAAW,CAACS,CAAG,CAAC,CAChD,CACJ,CACJ,CAAC,CASDM,QAAQ,CAAE,SAAAA,SAASC,CAAW,CAAEC,CAAI,CAAE,CAElC,GAAI,CAAAC,CAAU,CAAG,EAAE,CACfC,CAAS,CAAG,EAAE,CACdC,CAAI,CAER,IAAK,GAAI,CAAAX,CAAG,GAAI,CAAAQ,CAAI,CAAE,CAClB,GAAI,CAAAI,CAAK,CAAGJ,CAAI,CAACR,CAAG,CAAC,CACrBS,CAAU,EAAI,iCAA8B,CAAGG,CAAK,CAAG,YAAU,CAAGZ,CAAG,CAAG,aAC9E,CAEAU,CAAS,CAAG,iDAA6C,CAAGD,CAAU,CAAG,SAAS,CAClFE,CAAI,CAAGvB,CAAC,CAACsB,CAAS,CAAC,CACnBtB,CAAC,CAAC,MAAM,CAAC,CAACyB,MAAM,CAACF,CAAI,CAAC,CACtBvB,CAAC,CAACuB,CAAI,CAAC,CAACG,MAAM,EAClB,CAAC,CAQDC,eAAe,CAAE,SAAAA,gBAAUC,CAAM,CAAE,CAC/B,MAAO,KAAI,CAACC,iBAAiB,CAACD,CAAM,CACxC,CAAC,CAQDE,cAAc,CAAE,SAAAA,eAAUC,CAAG,CAAE,CAC3B,MAAO,KAAI,CAACC,WAAW,CAAC,CACpBC,IAAA,CAAQ,WAAW,CACnBL,MAAA,CAAU,CACNG,GAAA,CAAOA,CACX,CAAC,CACDG,KAAA,CAAS,QACb,CAAC,CACL,CAAC,CAQDC,UAAU,CAAE,SAAAA,WAAUC,CAAS,CAAE,CAO7B,MAAO,CAAC,CAAC,wJAAWC,IAAI,CAACD,CAAS,CACtC,CAAC,CAUDJ,WAAW,CAAE,SAAAA,YAAUZ,CAAI,CAAE,CACzB,GAAI,CAAAkB,CAAU,CAAG,GAAI,CAAAC,OAAO,CAAC,SAAUC,CAAO,CAAE,CAC5CvC,CAAI,CAACwC,MAAM,CAAClC,IAAI,CAACmC,SAAS,CAACtB,CAAI,CAAC,CAAC,CAACuB,IAAI,CAAC,SAAUC,CAAQ,CAAE,CACvDJ,CAAO,CAACI,CAAQ,CACpB,CAAC,CACL,CAAC,CAAC,CACF,MAAO,CAAAN,CACX,CAAC,CAODT,iBAAiB,CAAE,SAAAA,kBAAUT,CAAI,CAAE,CAC/B,GAAI,CAAAkB,CAAU,CAAG,GAAI,CAAAC,OAAO,CAAC,SAAUC,CAAO,CAAE,CAC5CvC,CAAI,CAAC4C,YAAY,CAACzB,CAAI,CAAC,CAACuB,IAAI,CAAC,SAAUC,CAAQ,CAAE,CAC7CJ,CAAO,CAACI,CAAQ,CACpB,CAAC,CACL,CAAC,CAAC,CACF,MAAO,CAAAN,CACX,CACJ,CACJ,CAAC,CAAC"}