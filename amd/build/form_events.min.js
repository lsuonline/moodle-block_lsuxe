define ("block_lsuxe/form_events",["jquery","block_lsuxe/xe_lib","block_lsuxe/notifications"],function(a,b,c){'use strict';return{getTokenReady:function getTokenReady(){var c=a("#id_available_moodle_instances option:selected").text();b.getTokenForURL(c).then(function(a){if(!0==a.success){sessionStorage.setItem("currentToken",a.data);sessionStorage.setItem("currentUrl",c)}})},getGroupData:function getGroupData(a){return b.jaxyPromise({call:"getGroupData",params:a,class:"router"})},setHiddenValue:function setHiddenValue(b,c){a("input[name="+b+"]").val(c)},verifySourceCourse:function verifySourceCourse(a){return b.jaxyPromise({call:"verifyCourse",params:a,class:"router"})},verifyDestCourse:function verifyDestCourse(a){var c={type:"GET",url:sessionStorage.getItem("currentUrl")+"/webservice/rest/server.php",data:{wstoken:sessionStorage.getItem("currentToken"),wsfunction:"core_course_get_courses_by_field",moodlewsrestformat:"json",field:"shortname",value:a.coursename}};return b.jaxyRemotePromise(c)},checkMarkOn:function checkMarkOn(b){a(b+" .circle-loader").css("visibility","visible")},checkMarkOff:function checkMarkOff(b){a(b+" .circle-loader").css("visibility","hidden")},checkMarkLoading:function checkMarkLoading(b){var c=b+" .circle-loader";this.checkMarkOn(b);if(a(c).hasClass("load-complete")){a(c).toggleClass("load-complete");a(b+" .checkmark").toggle()}},checkMarkComplete:function checkMarkComplete(b){var c=b+" .circle-loader";if(!a(c).hasClass("load-complete")){a(c).toggleClass("load-complete");a(b+" .checkmark").toggle()}},crossMarkOn:function crossMarkOn(b){a(b+" .circle-cross-loader").css("visibility","visible")},crossMarkOff:function crossMarkOff(b){a(b+" .circle-cross-loader").css("visibility","hidden")},registerMoodleEvents:function registerMoodleEvents(){var c=this;a("#id_verifysource").on("click",function(){var c=a("#id_instanceurl").val(),d=a("#id_instancetoken").val();b.testWebServices({type:"GET",url:c+"/webservice/rest/server.php",data:{wstoken:d,wsfunction:"block_lsuxe_XEAjax",moodlewsrestformat:"json",datachunk:{call:"testService",params:{},class:"router"}}}).then(function(a){console.log("What is the response for the test server: ",a)})});a("select#id_available_moodle_instances").on("change",function(){c.getTokenReady()})},registerMappingEvents:function registerMappingEvents(){var b=this,d=a("#id_srccourseshortname");d.change(function(){if(d.val()){b.getGroupData({courseid:d.val(),coursename:a("#id_srccourseshortname option:selected").text()}).then(function(c){if(1==c.count){a("#id_srccoursegroupnameselect").val(c.data.groupname);a("#id_srccoursegroupname").val(c.data.groupname)}else if(1<c.count){a("#id_srccoursegroupnameselect").empty();var d="";for(var e in c.data){if(""==d){d={groupid:c.data[e].groupid,groupname:c.data[e].groupname}}a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",c.data[e].groupid).text(c.data[e].groupname))}b.setHiddenValue("srccoursegroupname",d.groupname);b.setHiddenValue("srccoursegroupid",d.groupid)}})}else{a("#id_srccoursegroupnameselect").empty();a("#id_srccoursegroupnametext").text();a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",0).text("Please search for a course first"))}});a("#id_srccoursegroupnameselect").change(function(){var c=a(this).find("option:selected").attr("value"),d=a(this).find("option:selected").text();b.setHiddenValue("srccoursegroupname",d);b.setHiddenValue("srccoursegroupid",c)});a("#id_verifysource").on("click",function(){var d=a("#id_srccourseshortname").val(),e=a("#id_srccoursegroupname").val();if(1>d.length){c.callNoti({message:"Ooops, you forgot to enter a course short name",type:"error"});return}if(1>e.length){c.callNoti({message:"Ooops, you forgot to enter a group name",type:"error"});return}b.verifySourceCourse({coursename:d,groupname:e}).then(function(a){if(!1==a.success){c.callNoti({message:a.msg,type:"error"})}else{c.callNoti({message:"Everything checks out for the sourse course and group.",type:"success"})}})});a("#id_verifydest").on("click",function(){var d=a("#id_destcourseshortname").val();b.verifyDestCourse({coursename:d}).then(function(a){if("courses"in a){if(1==a.courses.length){c.callNoti({message:"Destination course is there and waiting for you.",type:"success"})}else{c.callNoti({message:"There seems to be more than one course with that shortname.",type:"warn"})}}else{c.callNoti({message:"The course: "+d+" was not found on the destination server.",type:"error"})}})})},registerEvents:function registerEvents(){if("mappings"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMappingEvents()}else if("moodles"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMoodleEvents()}},init:function init(){this.registerEvents();this.getTokenReady()}}});
//# sourceMappingURL=form_events.min.js.map
