define ("block_lsuxe/form_events",["jquery","block_lsuxe/xe_lib","block_lsuxe/notifications"],function(a,b,c){"use strict";return{getTokenReady:function getTokenReady(){var c=a("#id_available_moodle_instances option:selected").text();b.getTokenForURL(c).then(function(a){if(!0==a.success){sessionStorage.setItem("currentToken",a.data);sessionStorage.setItem("currentUrl",c)}else{console.log("ERROR: Failed to get the token :-( ")}})},getGroupData:function getGroupData(a){return b.jaxyPromise({call:"get_group_data",params:a,class:"router"})},setHiddenValue:function setHiddenValue(b,c){a("input[name="+b+"]").val(c)},verifySourceCourse:function verifySourceCourse(a){return b.jaxyPromise({call:"verify_course",params:a,class:"router"})},verifyDestCourse:function verifyDestCourse(a){var c={type:"GET",url:sessionStorage.getItem("currentUrl")+"/webservice/rest/server.php",data:{wstoken:sessionStorage.getItem("currentToken"),wsfunction:"core_course_get_courses_by_field",moodlewsrestformat:"json",field:"shortname",value:a.coursename}};return b.jaxyRemotePromise(c)},resetGroupList:function resetGroupList(){a("#id_srccoursegroupnameselect").empty();a("#id_srccoursegroupnametext").text();a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",0).text("Please search for a course first"))},registerMoodleEvents:function registerMoodleEvents(){a("#id_verifysource").on("click",function(){var d=a("#id_instanceurl").val(),e=a("#id_instancetoken").val(),f={type:"GET",url:d+"/webservice/rest/server.php",data:{wstoken:e,wsfunction:"block_lsuxe_xeajax",moodlewsrestformat:"json",datachunk:JSON.stringify({call:"test_service",params:{test:"test"},class:"router"})}};b.testWebServices(f).then(function(a){if(!1==a.success){c.callNoti({message:a.msg,type:"error"})}else{c.callNoti({message:"Successfully said hello to the remote Moodle instance .",type:"success"})}})})},registerMappingEvents:function registerMappingEvents(){var b=this,d=a("#id_srccourseshortname");d.change(function(){if(d.val()){b.getGroupData({courseid:d.val(),coursename:a("#id_srccourseshortname option:selected").text()}).then(function(c){if(0==c.count){b.resetGroupList()}else{a("#id_srccoursegroupnameselect").empty();var d="";for(var e in c.data){if(""==d){d={groupid:c.data[e].groupid,groupname:c.data[e].groupname}}a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",c.data[e].groupid).text(c.data[e].groupname))}b.setHiddenValue("srccoursegroupname",d.groupname);b.setHiddenValue("srccoursegroupid",d.groupid)}})}else{b.resetGroupList()}});a("#id_srccoursegroupnameselect").change(function(){var c=a(this).find("option:selected").attr("value"),d=a(this).find("option:selected").text();b.setHiddenValue("srccoursegroupname",d);b.setHiddenValue("srccoursegroupid",c)});a("#id_verifysource").on("click",function(){var d="",e="";if("1"==sessionStorage.getItem("xes_autocomplete")){d=a("#id_srccourseshortname").find("option:selected").text();e=a("#id_srccoursegroupnameselect").find("option:selected").text()}else{d=a("#id_srccourseshortname").val();e=a("#id_srccoursegroupname").val()}if(1>d.length){c.callNoti({message:"Ooops, you forgot to enter a course short name",type:"error"});return}if(1>e.length){c.callNoti({message:"Ooops, you forgot to enter a group name",type:"error"});return}b.verifySourceCourse({coursename:d,groupname:e}).then(function(a){if(!1==a.success){c.callNoti({message:a.msg,type:"error"})}else{b.setHiddenValue("srccourseid",a.data.id);b.setHiddenValue("srccoursegroupid",a.data.groupid);c.callNoti({message:"Everything checks out for the source course and group.",type:"success"})}})});a("#id_verifydest").on("click",function(){var d=a("#id_destcourseshortname").val();b.verifyDestCourse({coursename:d}).then(function(a){if("courses"in a){if(1==a.courses.length){b.setHiddenValue("destcourseid",a.courses[0].id);c.callNoti({message:"Destination course is there and waiting for you.",type:"success"})}else{c.callNoti({message:"There seems to be more than one course with that shortname.",type:"warn"})}}else{c.callNoti({message:"The course: "+d+" was not found on the destination server.",type:"error"})}})});a("select#id_available_moodle_instances").on("change",function(){b.getTokenReady();a("div.xe_dest_course_auto ul.form-autocomplete-suggestions").empty();a("div.xe_dest_course_auto input").val("");a("span.notifications").empty()})},registerEvents:function registerEvents(){if("mappings"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMappingEvents()}else if("moodles"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMoodleEvents()}},init:function init(){this.registerEvents();this.getTokenReady()}}});
//# sourceMappingURL=form_events.min.js.map
