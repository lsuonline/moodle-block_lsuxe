define ("block_lsuxe/form_events",["jquery","block_lsuxe/xe_lib"],function(a,b){'use strict';return{getTokenReady:function getTokenReady(){var c=a("#id_available_moodle_instances option:selected").text();b.getTokenForURL(c).then(function(a){if(!0==a.success){sessionStorage.setItem("currentToken",a.data);sessionStorage.setItem("currentUrl",c)}})},getGroupData:function getGroupData(a){return b.jaxyPromise({call:"getGroupData",params:a,class:"router"})},setHiddenValue:function setHiddenValue(b,c){a("input[name="+b+"]").val(c)},checkMarkOn:function checkMarkOn(b){console.log("checkMarkOn() -> has been called.");a(b+" .circle-loader").css("visibility","visible")},checkMarkOff:function checkMarkOff(b){console.log("checkMarkOff() -> has been called.");a(b+" .circle-loader").css("visibility","hidden")},checkMarkLoading:function checkMarkLoading(b){var c=b+" .circle-loader";this.checkMarkOn(b);if(a(c).hasClass("load-complete")){a(c).toggleClass("load-complete");a(b+" .checkmark").toggle()}console.log("checkMarkLoading() -> has been called.")},checkMarkComplete:function checkMarkComplete(b){var c=b+" .circle-loader";if(!a(c).hasClass("load-complete")){a(c).toggleClass("load-complete");a(b+" .checkmark").toggle()}},crossMarkOn:function crossMarkOn(b){console.log("crossMarkOn() -> has been called.");a(b+" .circle-cross-loader").css("visibility","visible")},crossMarkOff:function crossMarkOff(b){console.log("crossMarkOff() -> has been called.");a(b+" .circle-cross-loader").css("visibility","hidden")},registerMoodleEvents:function registerMoodleEvents(){var c=this;a("#id_instanceurl").on("input",function(){console.log("What is the input length: "+this.value.length);if(0<this.value.length){c.checkMarkLoading(".xe_confirm_url")}if(0==this.value.length){c.checkMarkOff(".xe_confirm_url")}});a("#id_instanceurl").on("blur",function(){if(0<this.value.length){if(b.isValidUrl(this.value)){console.log("The url is valid");c.checkMarkComplete(".xe_confirm_url");c.crossMarkOff(".xe_confirm_url")}else{c.checkMarkOff(".xe_confirm_url");c.crossMarkOn(".xe_confirm_url");console.log("The url is NOT valid")}}else{c.checkMarkOff(".xe_confirm_url");c.crossMarkOff(".xe_confirm_url")}});a("#id_instanceurl").on("focus",function(){c.crossMarkOff(".xe_confirm_url")});a("#id_instancetoken").on("input",function(){if(0<this.value.length){c.checkMarkLoading(".xe_confirm_token")}if(0==this.value.length){c.checkMarkOff(".xe_confirm_token")}});a("#id_instancetoken").on("blur",function(){if(31<this.value.length){c.checkMarkComplete(".xe_confirm_token");c.crossMarkOff(".xe_confirm_token")}else if(1>this.value.length){c.checkMarkOff(".xe_confirm_token");c.crossMarkOff(".xe_confirm_token")}else{c.crossMarkOn(".xe_confirm_token");console.log("The token is NOT valid")}});a("#id_instancetoken").on("focus",function(){c.crossMarkOff(".xe_confirm_token")});a("#id_verifysource").on("click",function(){var c=a("#id_instanceurl").val(),d=a("#id_instancetoken").val();console.log("What is the token: "+d);b.testWebServices({type:"GET",url:c+"/admin/webservice/testclient.php",data:{wstoken:d,wsfunction:"core_course_get_categories",moodlewsrestformat:"json"}}).then(function(a){console.log("What is the response for the test server: ",a)})})},registerMappingEvents:function registerMappingEvents(){var b=this,c=a("#id_srccourseshortname");c.change(function(){if(c.val()){b.getGroupData({courseid:c.val(),coursename:a("#id_srccourseshortname option:selected").text()}).then(function(c){if(1==c.count){a("#id_srccoursegroupnameselect").val(c.data.groupname);a("#id_srccoursegroupname").val(c.data.groupname)}else if(1<c.count){a("#id_srccoursegroupnameselect").empty();var d="";for(var e in c.data){if(""==d){d={groupid:c.data[e].groupid,groupname:c.data[e].groupname}}a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",c.data[e].groupid).text(c.data[e].groupname))}b.setHiddenValue("srccoursegroupname",d.groupname);b.setHiddenValue("srccoursegroupid",d.groupid)}})}else{a("#id_srccoursegroupnameselect").empty();a("#id_srccoursegroupnametext").text();a("#id_srccoursegroupnameselect").append(a("<option></option>").attr("value",0).text("Please search for a course first"))}});a("#id_srccoursegroupnameselect").change(function(){var c=a(this).find("option:selected").attr("value"),d=a(this).find("option:selected").text();b.setHiddenValue("srccoursegroupname",d);b.setHiddenValue("srccoursegroupid",c)});a("select#id_available_moodle_instances").on("change",function(){b.getTokenReady()})},registerEvents:function registerEvents(){if("mappings"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMappingEvents()}else if("moodles"==sessionStorage.getItem("xe_form")&&"true"==sessionStorage.getItem("xe_viewform")){this.registerMoodleEvents()}},init:function init(){this.registerEvents();this.getTokenReady()}}});
//# sourceMappingURL=form_events.min.js.map
